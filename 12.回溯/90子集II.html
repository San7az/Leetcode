<script>
  /**
   * @param {number[]} nums
   * @return {number[][]}
   */
  var subsetsWithDup = function (nums) {
    nums.sort((a, b) => a - b)
    const result = []
    const backtrack = (start, path, lastSelected = -1) => {
      result.push([...path])
      for (let i = start; i < nums.length; i++) {
        // 跳过重复元素
        if (i > start && nums[i] === nums[i - 1] && lastSelected !== i - 1) {
          continue
        }
        path.push(nums[i])
        backtrack(i + 1, path, i)
        path.pop()
      }
    }
    backtrack(0, [])
    return result
  }
</script>
